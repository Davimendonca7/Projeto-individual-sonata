<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
        <title>Sonata | Perfil</title>
    
        <script src="../js/sessao.js"></script>
        <link rel="icon" href="../imagens/SonataLogoSfundol.jpg">
        <link rel="stylesheet" href="../css/sweetalert.css">
        <link rel="icon" href="./assets/icon/favicon2.ico">
        <link rel="stylesheet" href="../css/header.css">
        <link rel="stylesheet" href="../css/perfil.css">
       
    </head>
<body onload="Dadosperfil(), logar()">
    
    <!-- header -->
    <div class="tela">
    <div class="header">
        <div class="logo">
            <a href="../usuario/homeUser.html"><img src="../imagens/SonataLogoSfundo.png" alt="" style="width:100px;"></a>
        </div>
        <div class="itens-nav">
                <a href="./homeUser.html">HOME</a>            
                <a href="./jogo1.html">JOGO</a>
                <a href="./analises.html">ANALYTICS</a>
                <a href="./mural.html">MURAL</a>
                <a href="#" onclick="limparSessao()">SAIR</a>
            
        </div>
    </div>
    <!-- fim header -->
    <main>
        <div class="container">
            <div class="fotoPerfil">
                <div class="foto">
                    <img src="../imagens/semFotoUser.png" alt="" >
                </div>
                <button class="btn_perfil" onclick="editar()">editar perfil</button>
            </div>

            <div class="dadosPerfil">
                <h1>SEU PERFIL</h1>
                <div class="dados">
                    <div class="dados2">
                        <span class="titulo"> Seu email</span> <br>
                    <span id="emailFav">email</span>
                    </div>
                    <div class="dados2">
                        <span class="titulo"> Sua senha</span> <br> 
                    <span id="senhaFav">senha</span>
                    </div>
                </div>
                <div class="dados">
                    <div class="dados2">
                        <span class="titulo">Instrumento favorito</span> <br>
                    <span id="instrumentoFav">instrumento</span>
                    </div>
                    <div class="dados2">
                        <span class="titulo">Música favorita</span> <br> 
                    <span id="musicaFav">musica</span>
                    </div>
                </div>
                <div class="dados">
                    <div class="dados2">
                        <span class="titulo">Gênero musical favorito</span> <br> 
                    <span id="generoFav">genero</span>
                    </div>
                    <div class="dados2">
                        <span class="titulo">Artista favorito</span> <br>
                     <span id="artistaFav">artista</span>
                    </div>
                </div>
            </div>
        </div>
        
    </main>
</div>

    <div class="form" id="form" style="display:none;">
        <div class="card_form">
            <h1>EDITAR PERFIL</h1>
           
            <!-- <p>edite seu perfil</p> -->
            <div class="texto1">
                <div class="texto2">
                    <label for="usuario">Mudar Email</label>
                    <input type="text" id="email_input" >
                </div>
                <div class="texto2">
                    <label for="usuario">Mudar Senha</label>
                    <input type="text" id="senha_input">
                </div>
            </div>
            <div class="texto1">
                <div class="texto2">
                    <label for="usuario">Instrumento Favorito</label>
                    <input type="text" id="instrumento_input">
                </div>
                <div class="texto2">
                    <label for="usuario">Música Favorita</label>
                    <input type="text" id="musica_input">
                </div>
            </div>
            <div class="texto1">
                <div class="texto2">
                    <label for="usuario">Gênero musical Favorito</label>
                    <input type="text" id="genero_input" >
                </div>
                <div class="texto2">
                    <label for="usuario">Artista Favorito</label>
                    <input type="text" id="artista_input">
                </div>
            </div>
           
            <button class="btn_form" onclick="atualizar()">ENVIAR</button>
          
            
        </div>
     </div>
        
    <script src="../js/sweetalertCadastro.js"></script>
</body>
</html>

<script>
    
    var idUsuario = sessionStorage.ID_USUARIO;
    
    function Dadosperfil(){
        
        console.log(idUsuario)

        fetch("/favorito/Dadosperfil", {
         method: "POST",
         headers: {
         "Content-Type": "application/json",
         },
        body: JSON.stringify({
        idUsuarioServer : idUsuario,
       
        }),

        }).then(function (resposta) {
            if(resposta.ok){
                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));
                    var email = resposta.email;
                    var senha = resposta.senha;
                    var instrumento = resposta.instrumento;
                    var musica = resposta.musica;
                    var genero = resposta.genero;
                    var artista = resposta.artista;
                    
                    console.log(email);
                    console.log(senha);
                    console.log(instrumento);
                    console.log(musica);
                    console.log(genero);
                    console.log(artista);
                    
                    emailFav.innerHTML = email;
                    senhaFav.innerHTML = senha;
                    instrumentoFav.innerHTML = instrumento;
                    musicaFav.innerHTML = musica;
                    generoFav.innerHTML = genero;
                    artistaFav.innerHTML = artista;

                    email_input.value = email;
                    senha_input.value = senha;
                    instrumento_input.value = instrumento;
                    musica_input.value = musica;
                    genero_input.value = genero;
                    artista_input.value = artista;

                    
                })

            }
           


    });
    }

    function editar(){
        form.style.display = "flex"
    }

    function atualizar(){
        var id = idUsuario
        var email = email_input.value; 
        var senha = senha_input.value; 
        var instrumento = instrumento_input.value; 
        var musica = musica_input.value; 
        var genero = genero_input.value; 
        var artista = artista_input.value; 

        if(email == "",
           senha == "",
           instrumento == "",
           musica == "",
           genero == "",
           artista == ""){

            const Toast = Swal.mixin({
                toast: true,
                position: "top-end",
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.onmouseenter = Swal.stopTimer;
                    toast.onmouseleave = Swal.resumeTimer;
                }
                });
                Toast.fire({
                    title: "Preencha os campos corretamente!",
                text: "Não pode haver campo em branco",
                icon: "error",
                color: "#F2CF63",
                background: "#011126",
                iconColor : "red",
                });
         

            return false;
          }

        fetch("/favorito/atualizar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        // crie um atributo que recebe o valor recuperado aqui
        // Agora vá para o arquivo routes/usuario.js
        idServer : id,
        emailServer : email,
        senhaServer : senha,
        instrumentoServer: instrumento,
        musicaServer: musica,
        generoServer: genero,
        artistaServer: artista,
       
      }),
    }) .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {

            const Toast = Swal.mixin({
                toast: true,
                position: "top-end",
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.onmouseenter = Swal.stopTimer;
                    toast.onmouseleave = Swal.resumeTimer;
                }
                });
                Toast.fire({
                    title: "Perfil atualizado!",
                text: "Seus dados foram atualizados",
                icon: "success",
                color: "#F2CF63",
                background: "#011126",
                iconColor : "#F2CF63",
                });
         
         console.log(resposta)
         
          
        setTimeout(() => {
                    window.location = "./perfil.html";
                  }, "2000");
          
        }
          
    
       
         
         else {
          throw "Houve um erro ao tentar realizar o formulario!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
       
      });

       
    }
</script>